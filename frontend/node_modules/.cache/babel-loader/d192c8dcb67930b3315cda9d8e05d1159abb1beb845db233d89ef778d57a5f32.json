{"ast":null,"code":"import _regenerator from \"C:/Users/als40/Desktop/HandsMarket/node_modules/@babel/runtime/helpers/esm/regenerator.js\";\nimport _asyncToGenerator from \"C:/Users/als40/Desktop/HandsMarket/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _jsxFileName = \"C:\\\\Users\\\\als40\\\\Desktop\\\\HandsMarket\\\\frontend\\\\src\\\\pages\\\\order\\\\payment.tsx\",\n  _this = this;\nimport React from \"react\";\nimport { getFirestore, collection, addDoc } from \"firebase/firestore\";\nimport { getApp } from \"firebase/app\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar Payment = function Payment(_ref) {\n  var products = _ref.products,\n    buyer = _ref.buyer,\n    paymentMethod = _ref.paymentMethod,\n    validateForm = _ref.validateForm;\n  var db = getFirestore(getApp());\n  var totalPrice = products.reduce(function (sum, product) {\n    return sum + product.price * product.quantity;\n  }, 0);\n  var handlePayment = function handlePayment() {\n    var _products$;\n    if (!validateForm()) {\n      return;\n    }\n    var paymentLabels = {\n      card: \"신용/체크카드\",\n      bank: \"무통장 입금\",\n      phone: \"핸드폰 결제\"\n    };\n    if (paymentMethod !== \"card\") {\n      alert(\"\\\"\".concat(paymentLabels[paymentMethod], \"\\\"\\uB294 \\uC544\\uC9C1 \\uC9C0\\uC6D0\\uD558\\uC9C0 \\uC54A\\uC2B5\\uB2C8\\uB2E4.\"));\n      return;\n    }\n\n    // 아임포트 모듈과 가맹점 코드 가져오기\n    var _window = window,\n      IMP = _window.IMP;\n    var merchantCode = process.env.REACT_APP_PORTONE_MERCHANT_ID;\n    if (!IMP || !merchantCode) return;\n    IMP.init(merchantCode); // 아임포트 초기화\n\n    // 결제 요청 정보 구성\n    var paymentData = {\n      pg: \"html5_inicis\",\n      pay_method: \"card\",\n      merchant_uid: \"mid_\".concat(Date.now()),\n      name: ((_products$ = products[0]) === null || _products$ === void 0 ? void 0 : _products$.name) || \"상품\",\n      amount: totalPrice,\n      buyer_email: buyer.email,\n      buyer_name: buyer.name,\n      buyer_tel: buyer.tel,\n      buyer_addr: buyer.address,\n      buyer_postcode: buyer.postcode\n    };\n\n    // 결제 요청\n    IMP.request_pay(paymentData, /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee(rsp) {\n        var _t;\n        return _regenerator().w(function (_context) {\n          while (1) switch (_context.n) {\n            case 0:\n              if (!rsp.success) {\n                _context.n = 5;\n                break;\n              }\n              _context.p = 1;\n              _context.n = 2;\n              return addDoc(collection(db, \"payments\"), {\n                imp_uid: rsp.imp_uid,\n                merchant_uid: rsp.merchant_uid,\n                amount: rsp.paid_amount,\n                buyer_email: rsp.buyer_email,\n                buyer_name: rsp.buyer_name,\n                status: \"paid\",\n                paid_at: new Date()\n              });\n            case 2:\n              alert(\"결제 성공!\");\n              _context.n = 4;\n              break;\n            case 3:\n              _context.p = 3;\n              _t = _context.v;\n              console.log(\"결제는 성공했지만 저장에 실패했습니다.\");\n            case 4:\n              _context.n = 6;\n              break;\n            case 5:\n              alert(\"\".concat(rsp.error_msg));\n            case 6:\n              return _context.a(2);\n          }\n        }, _callee, null, [[1, 3]]);\n      }));\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"w-full border mt-2 p-6 rounded-lg shadow-md space-y-6\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex justify-between text-lg font-semibold\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        children: \"\\uCD1D \\uACB0\\uC81C\\uAE08\\uC561\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(\"span\", {\n        children: [totalPrice.toLocaleString(), \"\\uC6D0\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(\"button\", {\n      type: \"button\",\n      onClick: handlePayment,\n      className: \"w-full bg-orange-500 text-white py-3 rounded-md text-lg hover:bg-orange-600 transition\",\n      children: \"\\uACB0\\uC81C\\uD558\\uAE30\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 108,\n    columnNumber: 5\n  }, _this);\n};\n_c = Payment;\nexport default Payment;\nvar _c;\n$RefreshReg$(_c, \"Payment\");","map":{"version":3,"names":["React","getFirestore","collection","addDoc","getApp","jsxDEV","_jsxDEV","Payment","_ref","products","buyer","paymentMethod","validateForm","db","totalPrice","reduce","sum","product","price","quantity","handlePayment","_products$","paymentLabels","card","bank","phone","alert","concat","_window","window","IMP","merchantCode","process","env","REACT_APP_PORTONE_MERCHANT_ID","init","paymentData","pg","pay_method","merchant_uid","Date","now","name","amount","buyer_email","email","buyer_name","buyer_tel","tel","buyer_addr","address","buyer_postcode","postcode","request_pay","_ref2","_asyncToGenerator","_regenerator","m","_callee","rsp","_t","w","_context","n","success","p","imp_uid","paid_amount","status","paid_at","v","console","log","error_msg","a","_x","apply","arguments","className","children","fileName","_jsxFileName","lineNumber","columnNumber","_this","toLocaleString","type","onClick","_c","$RefreshReg$"],"sources":["C:/Users/als40/Desktop/HandsMarket/frontend/src/pages/order/payment.tsx"],"sourcesContent":["import React from \"react\";\r\nimport { getFirestore, collection, addDoc } from \"firebase/firestore\";\r\nimport { getApp } from \"firebase/app\";\r\n\r\ndeclare global {\r\n  interface Window {\r\n    IMP?: any;\r\n  }\r\n}\r\n\r\ntype Product = {\r\n  name: string;\r\n  options: string;\r\n  quantity: number;\r\n  price: number;\r\n};\r\n\r\ntype Buyer = {\r\n  name: string;\r\n  email: string;\r\n  tel: string;\r\n  address: string;\r\n  postcode: string;\r\n};\r\n\r\ntype PaymentPageProps = {\r\n  products: Product[];\r\n  buyer: Buyer;\r\n  paymentMethod: \"card\" | \"bank\" | \"phone\";\r\n  validateForm: () => boolean;\r\n};\r\n\r\nconst Payment: React.FC<PaymentPageProps> = ({\r\n  products,\r\n  buyer,\r\n  paymentMethod,\r\n  validateForm,\r\n}) => {\r\n  const db = getFirestore(getApp());\r\n\r\n  const totalPrice = products.reduce(\r\n    (sum, product) => sum + product.price * product.quantity,\r\n    0\r\n  );\r\n\r\n  const handlePayment = () => {\r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    const paymentLabels = {\r\n      card: \"신용/체크카드\",\r\n      bank: \"무통장 입금\",\r\n      phone: \"핸드폰 결제\",\r\n    } as const;\r\n\r\n    if (paymentMethod !== \"card\") {\r\n      alert(`\"${paymentLabels[paymentMethod]}\"는 아직 지원하지 않습니다.`);\r\n      return;\r\n    }\r\n\r\n    // 아임포트 모듈과 가맹점 코드 가져오기\r\n    const { IMP } = window;\r\n    const merchantCode = process.env.REACT_APP_PORTONE_MERCHANT_ID;\r\n\r\n    if (!IMP || !merchantCode) return;\r\n\r\n    IMP.init(merchantCode); // 아임포트 초기화\r\n\r\n    // 결제 요청 정보 구성\r\n    const paymentData = {\r\n      pg: \"html5_inicis\",\r\n      pay_method: \"card\",\r\n      merchant_uid: `mid_${Date.now()}`,\r\n      name: products[0]?.name || \"상품\",\r\n      amount: totalPrice,\r\n      buyer_email: buyer.email,\r\n      buyer_name: buyer.name,\r\n      buyer_tel: buyer.tel,\r\n      buyer_addr: buyer.address,\r\n      buyer_postcode: buyer.postcode,\r\n    };\r\n\r\n    // 결제 요청\r\n    IMP.request_pay(paymentData, async (rsp: any) => {\r\n      if (rsp.success) {\r\n        try {\r\n          await addDoc(collection(db, \"payments\"), {\r\n            imp_uid: rsp.imp_uid,\r\n            merchant_uid: rsp.merchant_uid,\r\n            amount: rsp.paid_amount,\r\n            buyer_email: rsp.buyer_email,\r\n            buyer_name: rsp.buyer_name,\r\n            status: \"paid\",\r\n            paid_at: new Date(),\r\n          });\r\n          alert(\"결제 성공!\");\r\n        } catch (err) {\r\n          console.log(\"결제는 성공했지만 저장에 실패했습니다.\");\r\n        }\r\n      } else {\r\n        alert(`${rsp.error_msg}`);\r\n      }\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-full border mt-2 p-6 rounded-lg shadow-md space-y-6\">\r\n      <div className=\"flex justify-between text-lg font-semibold\">\r\n        <span>총 결제금액</span>\r\n        <span>{totalPrice.toLocaleString()}원</span>\r\n      </div>\r\n      <button\r\n        type=\"button\"\r\n        onClick={handlePayment}\r\n        className=\"w-full bg-orange-500 text-white py-3 rounded-md text-lg hover:bg-orange-600 transition\"\r\n      >\r\n        결제하기\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Payment;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}